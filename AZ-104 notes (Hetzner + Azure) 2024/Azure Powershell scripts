# enabling remoting - CloudShell
Enable-AzVMPSRemoting -Name 'azad_srv01' -ResourceGroupName 'rg_azad' -Protocol https -OsType Windows

#1 connecting to Azure Powershell 
Install-Module AzureRM
# connecting if there is a MFA configured
 connect-azAccount -TenantId "efb88f72-1a3c-4f14-b49a-cf37c6bfdc94"

#2 checking if correct subscription selected
Get-AzSubscription
Get-AzContext

# listing Azure VMs
az vm list # CLI
Get-AzVM # PS

# starting VM via Cloud Shell Web or local PS
get-azvm -name "azad-srv01" -Status | where PowerState -like "*dea*" | Start-vm

#stopping 
get-azvm -name "azad-srv01" -Status | where PowerState -like "*run*" |stop-azvm

# getting IP config for a network interface
$vm1=get-azvm -name TutorialVM1 

# showing subnets for a given VNet
(get-azvirtualNetwork).Subnets

#rename Resource group is NOT possible but you can create a new RG and move resources there 

New-AzresourceGroup -Name newrg -location northeurope
get-azreosurce Get-AzResource -ResourceGroupName test_rg1 |Move-AzResource -DestinationResourceGroupName testrg1
get-azreosurce  -ResourceGroupName testrg1 # checking


### VPN tunnel S2S ### Hetzner <> Azure ###

##VNET##

# creating RG
New-AzresourceGroup -name Test_RG1 -location northeurope

# defining frontend and backend subnets
$frontendSubnet=New-AzVirtualNetworkSubnetConfig -name frontendSubnet -AddressPrefix 10.1.1.0/24
$backendSubnet=New-AzVirtualNetworkSubnetConfig -name backendSubnet -AddressPrefix 10.1.2.0/24

# vnet
New-azvirtualnetwork -name VNet_test01 -ResourceGroupName Test_RG1 -verbose -AddressPrefix 10.1.0.0/16 -Subnet $backendSubnet,$frontendSubnet -Location northeurope

## gateway subnet
add-AzVirtualNetworkSubnetConfig -Name gatewaySubnet -VirtualNetwork $vnet -AddressPrefix "10.1.255.0/27"
# checking
(get-azvirtualNetwork).subnets

